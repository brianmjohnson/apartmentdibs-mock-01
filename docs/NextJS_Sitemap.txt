# ApartmentDibs - Next.js 15 App Router Site Map

## Overview

This document outlines the complete folder structure for the ApartmentDibs Next.js 15 application using the App Router architecture. The structure emphasizes:
- **Tenant-focused SEO architecture** with optimized public routes
- **Split homepage** serving both tenant search and landlord/agent acquisition (like StreetEasy)
- **Single auth-guarded portal** for all authenticated users (tenant, agent, landlord, admin)
- **API Routes** for tRPC endpoints, webhooks, and third-party integrations
- **Shared Components** using shadcn/ui with TypeScript

---

## Root Structure

```
apartmentdibs/
├── app/                          # Next.js App Router (all routes)
├── prisma/                       # Database schema & migrations
├── public/                       # Static assets
├── src/                          # Shared code (non-route)
├── .env                          # Environment variables (git-ignored)
├── .env.example                  # Example env vars (committed)
├── next.config.mjs               # Next.js configuration
├── package.json                  # Dependencies & scripts
├── tailwind.config.ts            # Tailwind CSS v4 configuration
├── tsconfig.json                 # TypeScript configuration
├── zenstack.config.ts            # ZenStack configuration
└── README.md                     # Project documentation
```

---

## app/ Directory (Next.js App Router)

### Public Routes (Tenant-Focused, SEO-Optimized)

**SEO Architecture Overview:**
- All public routes are statically generated (SSG) or use ISR for freshness
- Dynamic meta tags via `generateMetadata()` in each page.tsx
- Schema.org structured data embedded via JSON-LD
- XML sitemap auto-generated from dynamic routes
- Canonical URLs to prevent duplicate content

```
app/
├── (public)/                     # Route group: Public-facing pages (no auth required)
│   ├── layout.tsx                # Public layout (header, footer, no auth)
│   │                             # - Includes global SEO: default meta, fonts, analytics
│   │                             # - JSON-LD Organization schema
│   │
│   ├── sitemap.ts                # Dynamic XML sitemap generator
│   │                             # - All properties, buildings, businesses, neighborhoods
│   │                             # - Blog posts
│   │                             # - Priority + changefreq per route type
│   │
│   ├── robots.ts                 # Dynamic robots.txt
│   │                             # - Allow all public routes
│   │                             # - Disallow /portal/*, /api/*
│   │                             # - Sitemap reference
│   │
│   ├── page.tsx                  # HOMEPAGE - Split design (see below)
│   │                             # SEO: "ApartmentDibs | NYC Apartment Rentals"
│   │                             # Schema: WebSite, SearchAction
│   │
│   │                             # === HOMEPAGE STRUCTURE ===
│   │                             # HERO SECTION (Tenant-Focused):
│   │                             #   - Search bar: "Find your next apartment"
│   │                             #   - Location autocomplete, budget filter
│   │                             #   - CTA: "Search Rentals"
│   │                             #
│   │                             # SECONDARY SECTION (Landlord/Agent CTA):
│   │                             #   - "List your property" card
│   │                             #   - "Join as an Agent" card
│   │                             #   - Benefits: faster fills, compliance protection
│   │                             #   - CTA: "Get Started" → /for-landlords or /for-agents
│   │                             #
│   │                             # FEATURED LISTINGS:
│   │                             #   - Grid of 6-8 verified listings
│   │                             #   - "Verified" badge for ApartmentDibs listings
│   │                             #
│   │                             # SOCIAL PROOF:
│   │                             #   - Testimonials from Maya (tenant), Jessica (agent), David (landlord)
│   │                             #   - Metrics: "10,000+ verified renters", "500+ agents"
│   │                             #
│   │                             # NEIGHBORHOOD GUIDES:
│   │                             #   - Quick links to popular neighborhoods
│   │
│   ├── search/                   # Apartment search
│   │   ├── page.tsx              # Search results with filters
│   │   │                         # - Map view toggle
│   │   │                         # - Filters: price, beds, amenities, pet-friendly
│   │   │                         # - Sort: newest, price low-high, price high-low
│   │   │                         # - Infinite scroll or pagination
│   │   │                         #
│   │   │                         # SEO: Dynamic based on filters
│   │   │                         # Title: "2BR Apartments in Williamsburg | ApartmentDibs"
│   │   │                         # Description: "Find 45 available 2BR apartments in Williamsburg..."
│   │   │                         # Schema: ItemList of RealEstateListing
│   │   │                         # Canonical: /search?neighborhood=williamsburg&beds=2
│   │   └── loading.tsx           # Search loading skeleton
│   │
│   ├── property/                 # SEO-optimized property listings
│   │   └── [slug]/               # Individual property detail
│   │       ├── page.tsx          # Property page (photos, amenities, apply CTA)
│   │       │                     # - Photo gallery with lightbox
│   │       │                     # - Map with neighborhood info
│   │       │                     # - Hard/soft criteria disclosure
│   │       │                     # - "Apply with Verified Profile" CTA
│   │       │                     # - Building link if applicable
│   │       │                     # - Agent/landlord link
│   │       │                     # - Similar properties carousel
│   │       │                     #
│   │       │                     # SEO: Highly optimized for long-tail keywords
│   │       │                     # Title: "2BR Apartment at 123 Main St, Williamsburg | $3,000/mo"
│   │       │                     # Description: "Spacious 2BR with in-unit W/D, pet-friendly..."
│   │       │                     # Schema: RealEstateListing with full details
│   │       │                     # - price, address, geo, photos, amenities
│   │       │                     # - datePosted, petsAllowed, numberOfRooms
│   │       │                     # Keywords: "[beds]BR [neighborhood] apartment [amenities]"
│   │       │                     # Canonical: /property/[slug]
│   │       │                     # Alternate: link to building, business pages
│   │       ├── loading.tsx       # Property loading skeleton
│   │       └── opengraph-image.tsx  # Dynamic OG image for social sharing
│   │                             # - Property photo with price overlay
│   │                             # - Address and key amenities
│   │                             # - Optimized for Facebook, Twitter, iMessage
│   │
│   ├── building/                 # SEO-optimized building pages
│   │   ├── page.tsx              # Building search/browse
│   │   │                         # - Filter by amenities (doorman, gym, parking)
│   │   │                         # - Sort by total units, average rent
│   │   │                         #
│   │   │                         # SEO: Building directory
│   │   │                         # Title: "NYC Apartment Buildings | Find Your Perfect Building"
│   │   │                         # Schema: ItemList of ApartmentComplex
│   │   └── [slug]/               # Individual building detail
│   │       ├── page.tsx          # Building overview
│   │       │                     # - Building photos & description
│   │       │                     # - Amenities (gym, rooftop, laundry, etc.)
│   │       │                     # - Available units grid
│   │       │                     # - Past rental history (avg rent, days on market)
│   │       │                     # - Building reviews (future)
│   │       │                     # - Property manager/agent link
│   │       │                     #
│   │       │                     # SEO: Building-specific landing page
│   │       │                     # Title: "The William - Luxury Apartments in Williamsburg"
│   │       │                     # Description: "120-unit doorman building with gym, rooftop..."
│   │       │                     # Schema: ApartmentComplex
│   │       │                     # - address, geo, amenityFeature, numberOfAvailable
│   │       │                     # - aggregateRating (future)
│   │       │                     # Internal links: available units, neighborhood
│   │       └── opengraph-image.tsx  # Dynamic OG image
│   │                             # - Building exterior photo
│   │                             # - Name, neighborhood, key amenities
│   │
│   ├── business/                 # SEO-optimized agent/landlord/company profiles
│   │   ├── page.tsx              # Browse agents/property managers
│   │   │                         # - Filter by location, specialty
│   │   │                         # - Sort by listings count, response time
│   │   │                         #
│   │   │                         # SEO: Agent directory
│   │   │                         # Title: "NYC Real Estate Agents | ApartmentDibs Verified"
│   │   │                         # Schema: ItemList of RealEstateAgent
│   │   └── [slug]/               # Individual business profile
│   │       ├── page.tsx          # Public profile page
│   │       │                     # - Agent/landlord photo & bio
│   │       │                     # - Active listings grid
│   │       │                     # - Performance metrics (avg days-to-fill, response time)
│   │       │                     # - Contact form (routed through platform)
│   │       │                     # - Verified badge if subscribed
│   │       │                     #
│   │       │                     # SEO: Agent/company profile
│   │       │                     # Title: "Jessica Rodriguez - Metro Property Management | ApartmentDibs"
│   │       │                     # Description: "Senior Leasing Agent with 200+ leases closed..."
│   │       │                     # Schema: RealEstateAgent or LocalBusiness
│   │       │                     # - name, image, description, areaServed
│   │       │                     # - aggregateRating, numberOfListings
│   │       │                     # - contactPoint (routed through platform)
│   │       └── listings/         # All listings from this business
│   │           └── page.tsx      # Paginated listing grid
│   │                             # SEO: "[Agent Name]'s Available Listings"
│   │
│   ├── neighborhoods/            # SEO content - neighborhood guides
│   │   ├── page.tsx              # Neighborhood index (all areas)
│   │   │                         # SEO: "NYC Neighborhoods Guide | Where to Live"
│   │   │                         # Schema: ItemList of Place
│   │   └── [slug]/               # Individual neighborhood guide
│   │       └── page.tsx          # Neighborhood detail
│   │                             # - Overview & history
│   │                             # - Average rent by unit type
│   │                             # - Transit access
│   │                             # - Schools, parks, restaurants
│   │                             # - Available listings in area
│   │                             #
│   │                             # SEO: High-value content page
│   │                             # Title: "Williamsburg, Brooklyn | Apartments, Rent Prices, Things to Do"
│   │                             # Description: "Complete guide to renting in Williamsburg. Avg rent: $3,200..."
│   │                             # Schema: Place with geo, containedIn
│   │                             # - aggregateRating, review (future)
│   │                             # Internal links: available properties, buildings
│   │                             # Long-form content: 1,500+ words for SEO value
│   │
│   ├── for-landlords/            # Landlord acquisition marketing hub
│   │   ├── page.tsx              # Landlord landing page
│   │   │                         # - Hero: "Protect Your Investment, Fill Faster"
│   │   │                         # - Pain points: compliance risk, bad tenants, vacancy costs
│   │   │                         # - Solution overview: audit trails, risk scores, digital leases
│   │   │                         # - Testimonial: David Patel quote
│   │   │                         # - CTA: "Start Free Trial" → /register?role=landlord
│   │   │                         #
│   │   │                         # SEO: "Landlord Software | Tenant Screening & Compliance"
│   │   │                         # Schema: SoftwareApplication, offers
│   │   │
│   │   ├── pricing/              # Landlord-specific pricing
│   │   │   └── page.tsx          # Pricing tiers for landlords
│   │   │                         # - Free: 1 listing, basic screening
│   │   │                         # - Compliance ($249/yr): Unlimited listings, audit trail, adverse action
│   │   │                         # - Concierge ($499/yr + $99/listing): White-glove service (Sandra persona)
│   │   │                         # - Feature comparison table
│   │   │                         # - ROI calculator: "Save $53,500/year"
│   │   │                         # - Money-back guarantee
│   │   │
│   │   ├── faq/                  # Landlord-specific FAQ
│   │   │   └── page.tsx          # FAQs for landlord concerns
│   │   │                         # - "How does the audit trail protect me from lawsuits?"
│   │   │                         # - "What if I don't know Fair Housing laws?"
│   │   │                         # - "How do risk scores work?"
│   │   │                         # - "Can I use my own lease?"
│   │   │                         # - "What's included in concierge service?"
│   │   │                         # Schema: FAQPage
│   │   │
│   │   ├── compliance/           # Compliance deep-dive
│   │   │   └── page.tsx          # Fair housing compliance explanation
│   │   │                         # - How location-aware rules work
│   │   │                         # - NYC Fair Chance Act, California AB 2493, etc.
│   │   │                         # - Audit trail walkthrough
│   │   │                         # - Adverse action letter samples
│   │   │
│   │   ├── case-studies/         # Landlord success stories
│   │   │   ├── page.tsx          # Case study index
│   │   │   └── [slug]/           # Individual case study
│   │   │       └── page.tsx      # - "How David reduced vacancy by 56%"
│   │   │                         # - "Sandra's first year with concierge"
│   │   │                         # Schema: Article
│   │   │
│   │   └── demo/                 # Request demo / consultation
│   │       └── page.tsx          # Demo request form
│   │                             # - Calendar booking (Calendly embed)
│   │                             # - Phone callback option
│   │                             # - For larger portfolios (10+ units)
│   │
│   ├── for-agents/               # Agent acquisition marketing hub
│   │   ├── page.tsx              # Agent landing page
│   │   │                         # - Hero: "Close 25% More Leases, Save 20 Hours/Week"
│   │   │                         # - Pain points: document chasing, lost leads, compliance anxiety
│   │   │                         # - Solution overview: CRM, syndication, unified dashboard
│   │   │                         # - Testimonial: Jessica Rodriguez quote
│   │   │                         # - CTA: "Start Free Trial" → /register?role=agent
│   │   │                         #
│   │   │                         # SEO: "Leasing Agent Software | CRM & Listing Syndication"
│   │   │                         # Schema: SoftwareApplication, offers
│   │   │
│   │   ├── pricing/              # Agent-specific pricing
│   │   │   └── page.tsx          # Pricing tiers for agents
│   │   │                         # - Starter ($99/mo): 10 listings, basic CRM
│   │   │                         # - Professional ($299/mo): Unlimited listings, full CRM, syndication
│   │   │                         # - Enterprise (custom): Multi-agent teams, API access
│   │   │                         # - Feature comparison table
│   │   │                         # - ROI calculator: "Earn $150,000 more/year"
│   │   │                         # - Commission impact calculator
│   │   │
│   │   ├── faq/                  # Agent-specific FAQ
│   │   │   └── page.tsx          # FAQs for agent concerns
│   │   │                         # - "How does CRM auto-matching work?"
│   │   │                         # - "Which platforms do you syndicate to?"
│   │   │                         # - "Can my team share a subscription?"
│   │   │                         # - "How do I transfer existing listings?"
│   │   │                         # - "What's your SLA for support?"
│   │   │                         # Schema: FAQPage
│   │   │
│   │   ├── crm/                  # CRM feature deep-dive
│   │   │   └── page.tsx          # CRM capabilities explanation
│   │   │                         # - How denied applicants become warm leads
│   │   │                         # - Match scoring algorithm
│   │   │                         # - One-tap outreach
│   │   │                         # - Conversion tracking
│   │   │                         # - Network effect math
│   │   │
│   │   ├── syndication/          # Syndication feature deep-dive
│   │   │   └── page.tsx          # Listing syndication explanation
│   │   │                         # - Supported platforms (Zillow, Apartments.com, etc.)
│   │   │                         # - One-click updates
│   │   │                         # - De-listing automation
│   │   │                         # - QR code generation
│   │   │
│   │   ├── case-studies/         # Agent success stories
│   │   │   ├── page.tsx          # Case study index
│   │   │   └── [slug]/           # Individual case study
│   │   │       └── page.tsx      # - "How Jessica increased commissions by $150K"
│   │   │                         # - "Metro Property Management's 41x ROI"
│   │   │                         # Schema: Article
│   │   │
│   │   └── demo/                 # Request demo
│   │       └── page.tsx          # Demo request form
│   │                             # - Calendar booking
│   │                             # - For agencies with 5+ agents
│   │
│   ├── about/                    # About ApartmentDibs
│   │   └── page.tsx              # Company mission, team, press
│   │
│   ├── pricing/                  # Tenant pricing page (primary)
│   │   └── page.tsx              # Tenant screening profile pricing
│   │                             # - Basic Profile ($39.99): Credit + basic background, 60-day validity
│   │                             # - Premium Profile ($54.99): Full screening, Plaid income, 90-day validity
│   │                             # - Group Application ($99.99): Roommate screening
│   │                             # - Feature comparison table
│   │                             # - Money-back guarantee explanation
│   │                             # - "Why do I pay?" transparency section
│   │                             # - Links to /for-agents/pricing and /for-landlords/pricing
│   │                             #
│   │                             # SEO: "Tenant Screening Cost | Reusable Profile Pricing"
│   │                             # Schema: Product with offers
│   │
│   ├── faq/                      # Tenant FAQ page (consumer-focused)
│   │   └── page.tsx              # FAQs for tenants/renters
│   │                             # - "How does ApartmentDibs protect my privacy?"
│   │                             # - "Why is my info hidden from landlords?"
│   │                             # - "How long is my profile valid?"
│   │                             # - "What happens if I'm denied?"
│   │                             # - "How do I get matched to new listings?"
│   │                             # - "Is my data secure?"
│   │                             # - "How do I delete my account?"
│   │                             #
│   │                             # Links to: /for-agents/faq, /for-landlords/faq
│   │                             # Schema: FAQPage
│   │
│   ├── contact/                  # Contact page
│   │   └── page.tsx              # Contact form, support email, phone
│   │
│   ├── legal/                    # Legal pages
│   │   ├── terms/                # Terms of service
│   │   │   └── page.tsx
│   │   ├── privacy/              # Privacy policy (GDPR/CCPA)
│   │   │   └── page.tsx
│   │   └── fair-housing/         # Fair housing statement
│   │       └── page.tsx          # Commitment to compliance
│   │
│   └── blog/                     # Blog (SEO content)
│       ├── page.tsx              # Blog index (list of posts)
│       │                         # SEO: "ApartmentDibs Blog | NYC Rental Tips & Market Insights"
│       │                         # Schema: Blog with blogPost list
│       └── [slug]/               # Individual blog post
│           └── page.tsx          # - Renting guides
│                                 # - Market insights
│                                 # - Landlord tips
│                                 # - Fair housing education
│                                 #
│                                 # SEO: Article page
│                                 # Title: "[Post Title] | ApartmentDibs Blog"
│                                 # Schema: Article or BlogPosting
│                                 # - author, datePublished, dateModified
│                                 # - image, wordCount, articleSection
│                                 # Internal links: related posts, property search
│                                 # Target: 1,500+ words, optimize for featured snippets
```

### Authentication Routes

```
app/
├── (auth)/                       # Route group: Authentication flows
│   ├── layout.tsx                # Auth layout (centered form, no header/footer)
│   │
│   ├── login/                    # Login page
│   │   └── page.tsx              # Email/password OR OAuth (Google, Apple)
│   │
│   ├── register/                 # Registration page
│   │   └── page.tsx              # Choose persona: Tenant, Agent, Landlord
│   │                             # Query param: ?role=tenant|agent|landlord
│   │
│   ├── forgot-password/          # Password reset request
│   │   └── page.tsx
│   │
│   ├── reset-password/           # Password reset form (token-based)
│   │   └── page.tsx
│   │
│   └── verify-email/             # Email verification (after registration)
│       └── page.tsx
```

### Protected Portal (Single Auth Guard)

**IMPORTANT**: All authenticated routes live under `(portal)` with a single `layout.tsx` that handles:
- Authentication check (redirect to /login if not authenticated)
- Role-based sidebar rendering (tenant vs agent vs landlord vs admin)
- Session management

```
app/
├── (portal)/                     # Route group: ALL authenticated users
│   ├── layout.tsx                # MASTER AUTH GUARD + role-based layout
│   │                             # - Check session (Better Auth)
│   │                             # - Redirect to /login if unauthenticated
│   │                             # - Render role-specific sidebar based on user.role
│   │                             # - Common header with notifications, profile
│   │
│   ├── onboarding/               # Post-registration onboarding
│   │   ├── page.tsx              # Role-specific onboarding flow
│   │   ├── tenant/               # Tenant onboarding steps
│   │   │   ├── page.tsx          # Adaptive checklist (US-12)
│   │   │   ├── identity/         # Identity verification (Onfido)
│   │   │   │   └── page.tsx
│   │   │   ├── income/           # Income verification (Plaid)
│   │   │   │   └── page.tsx
│   │   │   ├── credit/           # Credit authorization (TransUnion)
│   │   │   │   └── page.tsx
│   │   │   ├── background/       # Background check (Checkr)
│   │   │   │   └── page.tsx
│   │   │   └── preferences/      # Search preferences
│   │   │       └── page.tsx      # Budget, neighborhoods, must-haves
│   │   │
│   │   ├── agent/                # Agent onboarding
│   │   │   ├── page.tsx          # Company info, license verification
│   │   │   └── subscription/     # Select subscription tier
│   │   │       └── page.tsx
│   │   │
│   │   └── landlord/             # Landlord onboarding
│   │       ├── page.tsx          # Property portfolio setup
│   │       └── subscription/     # Select compliance tier
│   │           └── page.tsx
│   │
│   │
│   │   # === TENANT DASHBOARD ROUTES ===
│   │
│   ├── tenant/                   # Tenant-specific routes
│   │   ├── dashboard/            # Tenant home
│   │   │   └── page.tsx          # Overview: applications, matches, profile status
│   │   │
│   │   ├── profile/              # Tenant profile management
│   │   │   ├── page.tsx          # Profile overview (verification status, reusability)
│   │   │   ├── edit/             # Edit profile
│   │   │   │   └── page.tsx
│   │   │   └── documents/        # Document management
│   │   │       └── page.tsx      # Upload/replace pay stubs, ID, references
│   │   │
│   │   ├── applications/         # Application management
│   │   │   ├── page.tsx          # List of all applications (US-14)
│   │   │   │                     # - Status badges (pending, approved, denied)
│   │   │   │                     # - Timeline visualization
│   │   │   │                     # - Position in queue
│   │   │   └── [applicationId]/  # Individual application detail
│   │   │       └── page.tsx      # Application status, messages, next steps
│   │   │
│   │   ├── matches/              # CRM matches (new listings matching preferences)
│   │   │   └── page.tsx          # Auto-matched listings from agent CRM
│   │   │
│   │   ├── saved/                # Saved/favorited listings
│   │   │   └── page.tsx          # Listings saved during search
│   │   │
│   │   ├── payments/             # Payment history
│   │   │   └── page.tsx          # Screening fees, rent payments (if current tenant)
│   │   │
│   │   └── settings/             # Tenant account settings
│   │       ├── page.tsx          # General settings
│   │       ├── notifications/    # Notification preferences
│   │       │   └── page.tsx
│   │       └── privacy/          # Privacy settings (GDPR/CCPA data export - US-25)
│   │           └── page.tsx
│   │
│   │
│   │   # === AGENT DASHBOARD ROUTES ===
│   │
│   ├── agent/                    # Agent-specific routes
│   │   ├── dashboard/            # Agent home
│   │   │   └── page.tsx          # KPIs: active listings, applicants, days-to-fill, CRM
│   │   │
│   │   ├── listings/             # Listing management
│   │   │   ├── page.tsx          # List of all listings (active, pending, rented)
│   │   │   ├── create/           # Create new listing
│   │   │   │   └── page.tsx      # Form with syndication options (US-7)
│   │   │   └── [listingId]/      # Individual listing management
│   │   │       ├── page.tsx      # Listing overview, syndication status
│   │   │       ├── edit/         # Edit listing
│   │   │       │   └── page.tsx
│   │   │       ├── applicants/   # Applicants for this listing
│   │   │       │   └── page.tsx  # Obfuscated profiles (US-1), compare, shortlist
│   │   │       ├── syndication/  # Syndication status per platform
│   │   │       │   └── page.tsx
│   │   │       └── analytics/    # Listing analytics
│   │   │           └── page.tsx  # Views, inquiries, application rate
│   │   │
│   │   ├── applicants/           # Unified applicant dashboard (US-5)
│   │   │   ├── page.tsx          # All applicants across all listings
│   │   │   │                     # - Real-time status updates
│   │   │   │                     # - Bulk actions
│   │   │   │                     # - Filtering & sorting
│   │   │   └── [applicantId]/    # Individual applicant detail
│   │   │       └── page.tsx      # Obfuscated profile, communication, notes
│   │   │
│   │   ├── crm/                  # CRM dashboard (US-6)
│   │   │   ├── page.tsx          # Warm leads from denied applicants
│   │   │   │                     # - Match scores
│   │   │   │                     # - One-tap outreach
│   │   │   │                     # - Conversion tracking
│   │   │   └── [leadId]/         # Individual CRM lead
│   │   │       └── page.tsx      # Lead profile, match history, outreach
│   │   │
│   │   ├── calendar/             # Showing calendar
│   │   │   └── page.tsx          # Calendar view of scheduled showings
│   │   │
│   │   ├── messages/             # In-app messaging (US-9)
│   │   │   └── page.tsx          # Unified inbox (applicants, landlords)
│   │   │
│   │   ├── analytics/            # Agent performance analytics
│   │   │   └── page.tsx          # Conversion rates, time-to-fill, commission
│   │   │
│   │   └── settings/             # Agent account settings
│   │       ├── page.tsx          # General settings
│   │       ├── team/             # Team management (multi-agent agencies)
│   │       │   └── page.tsx
│   │       ├── billing/          # Subscription billing (US-19)
│   │       │   └── page.tsx
│   │       └── notifications/    # Notification preferences
│   │           └── page.tsx
│   │
│   │
│   │   # === LANDLORD DASHBOARD ROUTES ===
│   │
│   ├── landlord/                 # Landlord-specific routes
│   │   ├── dashboard/            # Landlord home
│   │   │   └── page.tsx          # Overview: vacant units, pending decisions, payments
│   │   │
│   │   ├── properties/           # Property management
│   │   │   ├── page.tsx          # List of all properties owned
│   │   │   ├── create/           # Add new property
│   │   │   │   └── page.tsx
│   │   │   └── [propertyId]/     # Individual property
│   │   │       ├── page.tsx      # Property overview (units, leases, financials)
│   │   │       └── units/        # Units within property
│   │   │           └── [unitId]/
│   │   │               └── page.tsx  # Unit details, current tenant, lease
│   │   │
│   │   ├── listings/             # Active listings (vacant units)
│   │   │   ├── page.tsx          # Active listings (self-managed or via agent)
│   │   │   └── [listingId]/      # Individual listing
│   │   │       ├── page.tsx      # Listing details
│   │   │       └── applicants/   # Obfuscated applicant review (US-16)
│   │   │           └── page.tsx  # Shortlist, compare (US-1), risk scores (US-15)
│   │   │                         # - Decision logging (US-4)
│   │   │                         # - Denial reason selection (US-2)
│   │   │
│   │   ├── leases/               # Lease management
│   │   │   ├── page.tsx          # All leases (active, expiring, archived)
│   │   │   └── [leaseId]/        # Individual lease
│   │   │       ├── page.tsx      # Lease details, tenant info (post-selection)
│   │   │       └── renew/        # Lease renewal workflow
│   │   │           └── page.tsx
│   │   │
│   │   ├── payments/             # Rent payments
│   │   │   └── page.tsx          # Payment history, auto-pay status, late fees
│   │   │
│   │   ├── maintenance/          # Maintenance requests
│   │   │   └── page.tsx          # Tenant-submitted requests, work orders
│   │   │
│   │   ├── compliance/           # Compliance dashboard
│   │   │   ├── page.tsx          # Audit trail viewer (US-4)
│   │   │   │                     # - All decisions logged
│   │   │   │                     # - Adverse action letters sent
│   │   │   │                     # - PDF export for legal defense
│   │   │   └── audit/            # Generate audit reports
│   │   │       └── page.tsx
│   │   │
│   │   └── settings/             # Landlord account settings
│   │       ├── page.tsx          # General settings
│   │       ├── billing/          # Subscription billing (US-21)
│   │       │   └── page.tsx
│   │       └── notifications/    # Notification preferences
│   │           └── page.tsx
│   │
│   │
│   │   # === ADMIN DASHBOARD ROUTES ===
│   │
│   └── admin/                    # Admin routes (ApartmentDibs staff only)
│       ├── layout.tsx            # Admin-specific layout (requires admin role)
│       │
│       ├── dashboard/            # Admin home
│       │   └── page.tsx          # Platform metrics, revenue, active users
│       │
│       ├── users/                # User management
│       │   ├── page.tsx          # All users (tenants, agents, landlords)
│       │   └── [userId]/         # Individual user
│       │       └── page.tsx      # Impersonate, audit logs, ban/suspend
│       │
│       ├── listings/             # Listing moderation
│       │   └── page.tsx          # Flagged listings, fraud detection (US-22)
│       │
│       ├── compliance/           # Compliance monitoring
│       │   ├── page.tsx          # Fair housing alerts, audit access
│       │   └── rules/            # Compliance rule management (US-3)
│       │       └── page.tsx      # Update jurisdiction-specific rules
│       │
│       ├── support/              # Customer support
│       │   ├── page.tsx          # Support tickets, live chat queue
│       │   └── [ticketId]/       # Individual ticket
│       │       └── page.tsx
│       │
│       ├── analytics/            # Platform analytics (US-24)
│       │   └── page.tsx          # Acquisition, churn, revenue, feature usage
│       │
│       └── settings/             # Admin settings
│           ├── page.tsx          # Platform configuration
│           └── team/             # Admin team management
│               └── page.tsx
```

---

## api/ Routes (tRPC, Webhooks, Third-Party Integrations)

```
app/
├── api/                          # API routes
│   │
│   ├── trpc/                     # tRPC API endpoints
│   │   └── [trpc]/
│   │       └── route.ts          # tRPC handler (all procedures)
│   │
│   ├── webhooks/                 # Third-party webhooks
│   │   ├── stripe/               # Stripe (payments - US-19, 20, 21)
│   │   │   └── route.ts
│   │   ├── plaid/                # Plaid (income verification - US-12)
│   │   │   └── route.ts
│   │   ├── checkr/               # Checkr (background check)
│   │   │   └── route.ts
│   │   ├── onfido/               # Onfido (identity verification - US-23)
│   │   │   └── route.ts
│   │   ├── transunion/           # TransUnion (credit report)
│   │   │   └── route.ts
│   │   ├── sendgrid/             # SendGrid (email delivery status)
│   │   │   └── route.ts
│   │   └── twilio/               # Twilio (SMS delivery status)
│   │       └── route.ts
│   │
│   ├── auth/                     # Better Auth API routes
│   │   └── [...all]/
│   │       └── route.ts          # Better Auth handler
│   │
│   ├── upload/                   # File upload endpoint
│   │   └── route.ts              # Handle document uploads (Vercel Blob)
│   │
│   ├── export/                   # Data export (GDPR/CCPA - US-25)
│   │   └── route.ts              # Generate user data export
│   │
│   ├── syndication/              # Listing syndication callbacks (US-7)
│   │   ├── zillow/
│   │   │   └── route.ts
│   │   ├── apartments-com/
│   │   │   └── route.ts
│   │   └── streeteasy/
│   │       └── route.ts
│   │
│   └── health/                   # Health check endpoint (US-24)
│       └── route.ts              # GET /api/health
```

---

## src/ Directory (Shared Non-Route Code)

```
src/
├── components/                   # Shared React components
│   ├── ui/                       # shadcn/ui components
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── dialog.tsx
│   │   ├── dropdown-menu.tsx
│   │   ├── toast.tsx
│   │   └── ...
│   │
│   ├── layout/                   # Layout components
│   │   ├── header.tsx            # Public header (logo, nav, auth)
│   │   ├── footer.tsx            # Public footer
│   │   ├── sidebar.tsx           # Portal sidebar (role-aware)
│   │   ├── mobile-nav.tsx        # Mobile navigation
│   │   └── portal-header.tsx     # Portal header (notifications, profile)
│   │
│   ├── home/                     # Homepage components
│   │   ├── hero-search.tsx       # Tenant search hero
│   │   ├── landlord-cta.tsx      # Landlord/agent CTA section
│   │   ├── featured-listings.tsx # Featured listings grid
│   │   ├── testimonials.tsx      # Social proof testimonials
│   │   └── neighborhood-links.tsx # Neighborhood quick links
│   │
│   ├── search/                   # Search components
│   │   ├── search-filters.tsx    # Filter sidebar/modal
│   │   ├── search-results.tsx    # Results grid/list
│   │   ├── search-map.tsx        # Map view integration
│   │   └── listing-card.tsx      # Individual listing card
│   │
│   ├── property/                 # Property page components
│   │   ├── photo-gallery.tsx     # Photo gallery with lightbox
│   │   ├── property-details.tsx  # Details table
│   │   ├── criteria-disclosure.tsx # Hard/soft criteria
│   │   ├── apply-cta.tsx         # Apply with profile CTA
│   │   └── similar-listings.tsx  # Similar properties carousel
│   │
│   ├── building/                 # Building page components
│   │   ├── building-overview.tsx
│   │   ├── amenities-grid.tsx
│   │   ├── available-units.tsx
│   │   └── building-history.tsx
│   │
│   ├── business/                 # Business profile components
│   │   ├── agent-profile.tsx
│   │   ├── listing-grid.tsx
│   │   ├── performance-metrics.tsx
│   │   └── contact-form.tsx
│   │
│   ├── forms/                    # Form components
│   │   ├── profile-form.tsx      # Tenant profile creation
│   │   ├── listing-form.tsx      # Agent listing creation
│   │   ├── application-form.tsx  # Tenant application
│   │   ├── screening-criteria-form.tsx  # Landlord screening criteria (US-3)
│   │   └── decision-form.tsx     # Landlord decision with reason (US-2, 4)
│   │
│   ├── applicants/               # Applicant components
│   │   ├── applicant-card.tsx    # Obfuscated applicant card (US-1)
│   │   ├── comparison-table.tsx  # Side-by-side comparison (US-4)
│   │   ├── risk-score-badge.tsx  # Risk score display (US-15)
│   │   └── pii-reveal-modal.tsx  # PII reveal after selection (US-1)
│   │
│   ├── crm/                      # CRM components (US-6)
│   │   ├── crm-lead-card.tsx
│   │   ├── match-score.tsx
│   │   └── outreach-button.tsx
│   │
│   ├── compliance/               # Compliance components
│   │   ├── audit-trail.tsx       # Audit log viewer (US-4)
│   │   ├── adverse-action.tsx    # Adverse action letter (US-2)
│   │   ├── compliance-badge.tsx  # Location compliance status (US-3)
│   │   └── audit-export.tsx      # PDF export button
│   │
│   ├── onboarding/               # Onboarding components (US-12)
│   │   ├── checklist.tsx         # Adaptive checklist
│   │   ├── progress-bar.tsx      # Progress indicator
│   │   └── verification-step.tsx # Individual verification step
│   │
│   └── notifications/            # Notification components (US-14)
│       ├── notification-bell.tsx
│       ├── notification-list.tsx
│       └── notification-toast.tsx
│
├── server/                       # Server-side code
│   ├── api/                      # tRPC routers
│   │   ├── routers/
│   │   │   ├── tenant.ts         # Tenant procedures
│   │   │   ├── agent.ts          # Agent procedures
│   │   │   ├── landlord.ts       # Landlord procedures
│   │   │   ├── listing.ts        # Listing CRUD + syndication (US-7)
│   │   │   ├── application.ts    # Application workflow
│   │   │   ├── crm.ts            # CRM procedures (US-6)
│   │   │   ├── compliance.ts     # Compliance (audit, adverse action)
│   │   │   ├── search.ts         # Public search
│   │   │   ├── building.ts       # Building data
│   │   │   └── business.ts       # Agent/landlord profiles
│   │   ├── trpc.ts               # tRPC context
│   │   └── root.ts               # Root router
│   │
│   ├── db.ts                     # Prisma client
│   │
│   ├── auth.ts                   # Better Auth configuration
│   │
│   └── services/                 # Business logic services
│       ├── verification/         # Verification services
│       │   ├── identity.ts       # Onfido (US-23)
│       │   ├── income.ts         # Plaid (US-12)
│       │   ├── credit.ts         # TransUnion
│       │   └── background.ts     # Checkr
│       │
│       ├── compliance/           # Compliance services
│       │   ├── pii-scrubbing.ts  # PII anonymization (US-1)
│       │   ├── audit-trail.ts    # Audit logging (US-4)
│       │   ├── adverse-action.ts # Letter generation (US-2)
│       │   ├── rules-engine.ts   # Location-aware rules (US-3)
│       │   └── fraud-detection.ts # Fraud detection (US-22)
│       │
│       ├── payments/             # Payment services
│       │   └── stripe.ts         # Stripe integration (US-19, 20, 21)
│       │
│       ├── messaging/            # Messaging services (US-8, 9)
│       │   ├── email.ts          # SendGrid
│       │   ├── sms.ts            # Twilio
│       │   └── push.ts           # Firebase Cloud Messaging
│       │
│       ├── syndication/          # Listing syndication (US-7)
│       │   ├── zillow.ts
│       │   ├── apartments.ts
│       │   ├── craigslist.ts
│       │   ├── facebook.ts
│       │   └── streeteasy.ts
│       │
│       ├── matching/             # Matching services
│       │   ├── crm-matcher.ts    # CRM lead matching (US-6)
│       │   └── risk-scorer.ts    # Risk score calculation (US-15)
│       │
│       └── documents/            # Document services
│           ├── lease-generator.ts # Digital lease (US-17)
│           └── export.ts         # GDPR/CCPA export (US-25)
│
├── lib/                          # Utility libraries
│   ├── utils.ts                  # General utilities
│   ├── validators.ts             # Zod schemas
│   ├── constants.ts              # App-wide constants
│   ├── seo.ts                    # SEO metadata helpers
│   └── structured-data.ts        # Schema.org JSON-LD generators
│
├── hooks/                        # Custom React hooks
│   ├── use-user.ts               # Current user (Better Auth)
│   ├── use-listings.ts           # Listings queries
│   ├── use-applications.ts       # Applications queries
│   ├── use-crm.ts                # CRM queries
│   └── use-notifications.ts      # Real-time notifications
│
└── types/                        # TypeScript types
    ├── api.ts                    # API response types
    ├── models.ts                 # Prisma-generated types
    └── enums.ts                  # Shared enums
```

---

## User Story Coverage Matrix

This sitemap supports all 25 user stories from the User Stories document:

### Compliance & Fair Housing
| Story | Feature | Route(s) |
|-------|---------|----------|
| US-1 | PII Anonymization | `/portal/landlord/listings/[id]/applicants`, `/portal/agent/applicants` |
| US-2 | Adverse Action Notices | `/portal/landlord/compliance`, `src/server/services/compliance/adverse-action.ts` |
| US-3 | Location-Aware Compliance | `/portal/admin/compliance/rules`, `src/server/services/compliance/rules-engine.ts` |
| US-4 | Audit Trail | `/portal/landlord/compliance/audit`, `src/server/services/compliance/audit-trail.ts` |

### Agent Efficiency
| Story | Feature | Route(s) |
|-------|---------|----------|
| US-5 | Unified Dashboard | `/portal/agent/applicants` |
| US-6 | CRM Auto-Matching | `/portal/agent/crm` |
| US-7 | Listing Syndication | `/portal/agent/listings/create`, `/portal/agent/listings/[id]/syndication` |
| US-8 | Document Reminders | `src/server/services/messaging` (automated) |
| US-9 | In-App Messaging | `/portal/agent/messages` |

### Tenant Value
| Story | Feature | Route(s) |
|-------|---------|----------|
| US-10 | Reusable Profile | `/portal/tenant/profile` |
| US-11 | Group Application | `/portal/tenant/applications` (roommate flow) |
| US-12 | Adaptive Onboarding | `/portal/onboarding/tenant` |
| US-13 | Budget Pre-Qualification | `/search`, `/property/[slug]` (criteria disclosure) |
| US-14 | Status Notifications | `/portal/tenant/applications/[id]` |

### Landlord Protection
| Story | Feature | Route(s) |
|-------|---------|----------|
| US-15 | Risk Scores | `/portal/landlord/listings/[id]/applicants` |
| US-16 | Obfuscated Dashboard | `/portal/landlord/listings/[id]/applicants` |
| US-17 | Digital Lease | `/portal/landlord/leases` |
| US-18 | Concierge Service | `/contact` (phone support), dedicated onboarding flow |

### Monetization
| Story | Feature | Route(s) |
|-------|---------|----------|
| US-19 | Agent Billing | `/portal/agent/settings/billing` |
| US-20 | Tenant Screening Fees | `/portal/onboarding/tenant` (payment step) |
| US-21 | Landlord Compliance Tier | `/portal/landlord/settings/billing` |

### Platform Integrity
| Story | Feature | Route(s) |
|-------|---------|----------|
| US-22 | Fraud Detection | `/portal/admin/listings`, `src/server/services/compliance/fraud-detection.ts` |
| US-23 | Identity Verification | `/portal/onboarding/tenant/identity` |
| US-24 | Platform Uptime | `/api/health`, `/portal/admin/analytics` |
| US-25 | GDPR/CCPA Export | `/portal/*/settings/privacy`, `/api/export` |

---

## Customer Journey Route Mapping

### Tenant Journey (from Customer Journey Map)

| Stage | Primary Routes |
|-------|---------------|
| Discovery | `/`, `/search`, `/neighborhoods/[slug]` |
| Engagement | `/property/[slug]`, `/building/[slug]` |
| Onboarding | `/register`, `/portal/onboarding/tenant/*` |
| Application | `/portal/tenant/applications`, `/portal/tenant/matches` |
| Decision | `/portal/tenant/applications/[id]` |
| Post-Move-In | `/portal/tenant/payments`, `/portal/tenant/settings` |

### Agent Journey

| Stage | Primary Routes |
|-------|---------------|
| Listing Creation | `/portal/agent/listings/create` |
| Applicant Management | `/portal/agent/applicants`, `/portal/agent/messages` |
| Landlord Review | Forward to landlord via platform |
| Lease Signing | Digital lease via DocuSign integration |
| CRM Utilization | `/portal/agent/crm` |

### Landlord Journey

| Stage | Primary Routes |
|-------|---------------|
| Property Setup | `/portal/landlord/properties/create` |
| Listing Review | `/portal/landlord/listings/[id]/applicants` |
| Decision | Applicant selection with reason logging |
| Lease | `/portal/landlord/leases/[id]` |
| Compliance | `/portal/landlord/compliance` |

---

## SEO Strategy

### URL Patterns for Discoverability

| Entity | URL Pattern | Example |
|--------|-------------|---------|
| Property | `/property/[address-beds-city]` | `/property/123-main-st-2br-brooklyn` |
| Building | `/building/[name-city]` | `/building/the-william-brooklyn` |
| Business | `/business/[name]` | `/business/metro-property-management` |
| Neighborhood | `/neighborhoods/[name]` | `/neighborhoods/williamsburg` |
| Blog | `/blog/[slug]` | `/blog/nyc-renting-guide-2025` |

### Structured Data (Schema.org)

- **Property pages**: `RealEstateListing` schema
- **Building pages**: `ApartmentComplex` schema
- **Business pages**: `RealEstateAgent` or `LocalBusiness` schema
- **Neighborhood pages**: `Place` schema with `geo` coordinates

### Meta Tags Strategy

Each public page includes:
- Dynamic `<title>` with keywords
- `<meta name="description">` with call-to-action
- Open Graph tags for social sharing
- Dynamic `opengraph-image.tsx` for listings/buildings

---

## Middleware (app/middleware.ts)

```typescript
// app/middleware.ts
// Single auth guard for all portal routes

import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // 1. Check if route is in protected portal
  if (pathname.startsWith('/portal')) {
    // Check for session cookie (Better Auth)
    const sessionToken = request.cookies.get('better-auth.session_token');

    if (!sessionToken) {
      // Redirect to login with return URL
      const loginUrl = new URL('/login', request.url);
      loginUrl.searchParams.set('redirect', pathname);
      return NextResponse.redirect(loginUrl);
    }

    // 2. Role-based access control
    // Check if user role matches route (tenant, agent, landlord, admin)
    // This is handled more granularly in layout.tsx with session data
  }

  // 3. Audit trail logging for PII access
  if (pathname.includes('/applicants/') && pathname.includes('/portal')) {
    // Log PII access attempt for compliance
    // Actual logging happens in API routes with full context
  }

  return NextResponse.next();
}

export const config = {
  matcher: [
    '/portal/:path*',  // All portal routes
    '/api/:path*',     // Protect API routes (tRPC handles its own auth)
  ],
};
```

---

## Key Architecture Decisions

### 1. Single Auth Guard at Portal Level

**Why**: Simplifies auth logic, single source of truth, easier to maintain

**Implementation**:
- `(portal)/layout.tsx` handles all authentication
- Role-based sidebar rendering in same layout
- No duplicate auth checks in child routes

### 2. SEO-First Public Routes

**Why**: Maximize organic tenant acquisition, compete with Zillow/StreetEasy

**Implementation**:
- `/property/[slug]` with descriptive slugs
- `/building/[slug]` for building-level SEO
- `/business/[slug]` for agent/landlord profiles
- Schema.org structured data on all public pages

### 3. Split Homepage Design

**Why**: Serve both tenant search (primary) and landlord/agent acquisition (secondary)

**Implementation**:
- Hero search bar for tenants
- Secondary CTA section for landlords/agents
- Featured listings for engagement
- Testimonials for social proof

### 4. Unified Portal with Role-Based Views

**Why**: Reduce code duplication, consistent UX patterns, easier onboarding between roles

**Implementation**:
- Shared portal layout with role-aware sidebar
- Common components for similar features (notifications, settings)
- Role-specific route prefixes (`/portal/tenant`, `/portal/agent`, `/portal/landlord`)

---

## Performance Considerations

### Route-Level Optimizations

| Route Type | Optimization |
|------------|--------------|
| Public listing pages | Static generation with ISR (revalidate: 3600) |
| Search results | Server-side rendering with Redis caching |
| Portal dashboards | Client-side rendering with React Query |
| Audit trail | Pagination with virtual scrolling |

### Caching Strategy

- **Redis**: Search results, CRM matches, applicant counts
- **CDN**: Static assets, OG images
- **Browser**: User session, saved listings

---

## Future Enhancements

### Parallel Routes (Phase 2)
```
app/(portal)/agent/listings/[listingId]/@modal/applicant/[applicantId]/page.tsx
```
- Modal overlays for applicant detail
- Split view for comparison

### Intercepting Routes (Phase 2)
```
app/(public)/search/(.)property/[slug]/page.tsx
```
- Preview property in modal without full navigation
- Better mobile UX

### Mobile App (Phase 3)
- React Native with Expo
- Shared tRPC client
- Similar route structure

---

*This site map should be updated as new features are added or routing patterns change. Last updated to align with Customer Journey Map, Personas, and User Stories documents.*
